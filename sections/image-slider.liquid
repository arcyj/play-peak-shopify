{%- liquid
  comment
    Image slider with full-width slides and multiple layout options
  endcomment
-%}

<div class='color-{{ section.settings.color_scheme }} isolate gradient tw-pt-80 tw-mt-32'>
  <slider-component class='slider-mobile-gutter slider-component-full-width slider-component-desktop {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}'>
    <ul
      id='Slider-{{ section.id }}'
      data-id='{{ section.id }}'
      class='grid image-slider-grid slider slider--mobile slider--desktop slider--tablet'
      role='list'
      aria-label='{{ 'general.slider.name' | t }}'
    >
      {%- if section.blocks.size > 0 -%}
        {%- for block in section.blocks -%}
          <li
            id='Slide-{{ section.id }}-{{ forloop.index }}'
            class='grid__item slider__slide image-slider-slide image-slider-layout-{{ block.settings.layout }} {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}'
            {{ block.shopify_attributes }}
            {% if settings.animations_reveal_on_scroll %}
              data-cascade
              style='--animation-order: {{ forloop.index }};'
            {% endif %}
          >
            {%- case block.settings.layout -%}
              {%- when 1 -%}
                <!-- Layout 1: One large image + two medium images -->
                <div class='image-slider-layout-1'>
                  <div class='image-slider-large'>
                    {%- if block.settings.image_1 -%}
                      <img
                        src='{{ block.settings.image_1 | image_url: width: 800 }}'
                        alt='{{ block.settings.image_1.alt | escape }}'
                        class='image-slider-img'
                        width='800'
                        height='600'
                        loading='lazy'
                      >
                    {%- else -%}
                      <div class='placeholder-svg'>
                        <span>Medium Image</span>
                      </div>
                    {%- endif -%}
                  </div>
                  <div class='image-slider-medium-container'>
                    <div class='image-slider-medium'>
                      {%- if block.settings.image_2 -%}
                        <img
                          src='{{ block.settings.image_2 | image_url: width: 400 }}'
                          alt='{{ block.settings.image_2.alt | escape }}'
                          class='image-slider-img'
                          width='400'
                          height='300'
                          loading='lazy'
                        >
                      {%- else -%}
                        <div class='placeholder-svg'>
                          <span>Medium Image</span>
                        </div>
                      {%- endif -%}
                    </div>
                    <div class='image-slider-medium'>
                      {%- if block.settings.image_3 -%}
                        <img
                          src='{{ block.settings.image_3 | image_url: width: 400 }}'
                          alt='{{ block.settings.image_3.alt | escape }}'
                          class='image-slider-img'
                          width='400'
                          height='300'
                          loading='lazy'
                        >
                      {%- else -%}
                        <div class='placeholder-svg'>
                          <span>Medium Image</span>
                        </div>
                      {%- endif -%}
                    </div>
                  </div>
                </div>

              {%- when 2 -%}
                <!-- Layout 2: One large image + four small images -->
                <div class='image-slider-layout-2'>
                  <div class='image-slider-large'>
                    {%- if block.settings.image_1 -%}
                      <img
                        src='{{ block.settings.image_1 | image_url: width: 800 }}'
                        alt='{{ block.settings.image_1.alt | escape }}'
                        class='image-slider-img'
                        width='800'
                        height='600'
                        loading='lazy'
                      >
                    {%- else -%}
                      <div class='placeholder-svg'>
                        <span>Medium Image</span>
                      </div>
                    {%- endif -%}
                  </div>
                  <div class='image-slider-small-container'>
                    <div class='image-slider-small'>
                      {%- if block.settings.image_2 -%}
                        <img
                          src='{{ block.settings.image_2 | image_url: width: 200 }}'
                          alt='{{ block.settings.image_2.alt | escape }}'
                          class='image-slider-img'
                          width='200'
                          height='150'
                          loading='lazy'
                        >
                      {%- else -%}
                        <div class='placeholder-svg'>
                          <span>Small Image</span>
                        </div>
                      {%- endif -%}
                    </div>
                    <div class='image-slider-small'>
                      {%- if block.settings.image_3 -%}
                        <img
                          src='{{ block.settings.image_3 | image_url: width: 200 }}'
                          alt='{{ block.settings.image_3.alt | escape }}'
                          class='image-slider-img'
                          width='200'
                          height='150'
                          loading='lazy'
                        >
                      {%- else -%}
                        <div class='placeholder-svg'>
                          <span>Small Image</span>
                        </div>
                      {%- endif -%}
                    </div>
                    <div class='image-slider-small'>
                      {%- if block.settings.image_4 -%}
                        <img
                          src='{{ block.settings.image_4 | image_url: width: 200 }}'
                          alt='{{ block.settings.image_4.alt | escape }}'
                          class='image-slider-img'
                          width='200'
                          height='150'
                          loading='lazy'
                        >
                      {%- else -%}
                        <div class='placeholder-svg'>
                          <span>Small Image</span>
                        </div>
                      {%- endif -%}
                    </div>
                    <div class='image-slider-small'>
                      {%- if block.settings.image_5 -%}
                        <img
                          src='{{ block.settings.image_5 | image_url: width: 200 }}'
                          alt='{{ block.settings.image_5.alt | escape }}'
                          class='image-slider-img'
                          width='200'
                          height='150'
                          loading='lazy'
                        >
                      {%- else -%}
                        <div class='placeholder-svg'>
                          <span>Small Image</span>
                        </div>
                      {%- endif -%}
                    </div>
                  </div>
                </div>

              {%- when 3 -%}
                <!-- Layout 3: Two large images -->
                <div class='image-slider-layout-3'>
                  <div class='image-slider-large'>
                    {%- if block.settings.image_1 -%}
                      <img
                        src='{{ block.settings.image_1 | image_url: width: 600 }}'
                        alt='{{ block.settings.image_1.alt | escape }}'
                        class='image-slider-img'
                        width='600'
                        height='400'
                        loading='lazy'
                      >
                    {%- else -%}
                      <div class='placeholder-svg'>
                        <span>Medium Image</span>
                      </div>
                    {%- endif -%}
                  </div>
                  <div class='image-slider-large'>
                    {%- if block.settings.image_2 -%}
                      <img
                        src='{{ block.settings.image_2 | image_url: width: 600 }}'
                        alt='{{ block.settings.image_2.alt | escape }}'
                        class='image-slider-img'
                        width='600'
                        height='400'
                        loading='lazy'
                      >
                    {%- else -%}
                      <div class='placeholder-svg'>
                        <span>Medium Image</span>
                      </div>
                    {%- endif -%}
                  </div>
                </div>
            {%- endcase -%}
          </li>
        {%- endfor -%}
      {%- else -%}
        <li class='grid__item slider__slide image-slider-slide'>
          <div class='placeholder-svg' style='min-height: 400px;'>
            <span>Add slides to see your image slider</span>
          </div>
        </li>
      {%- endif -%}
    </ul>

    <span class='slider-gradient-left'>
      <button
        type='button'
        class='slider-button slider-button--prev slider-button-left'
        name='previous'
        aria-label='{{ 'general.slider.previous_slide' | t }}'
      >
        <span class='svg-wrapper'>
          {{- 'icon-caret.svg' | inline_asset_content -}}
        </span>
      </button>
    </span>
    <span class='slider-gradient-right'>
      <button
        type='button'
        class='slider-button slider-button--next slider-button-right'
        name='next'
        aria-label='{{ 'general.slider.next_slide' | t }}'
      >
        <span class='svg-wrapper'>
          {{- 'icon-caret.svg' | inline_asset_content -}}
        </span>
      </button>
    </span>
  </slider-component>
</div>

<style>
  /* Full width slider container */
  .image-slider-grid {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    width: 100%;
    margin: 0;
    padding: 0;
  }

  /* Each slide takes full width */
  .image-slider-slide {
    flex: 0 0 100vw;
    width: 100vw;
    scroll-snap-align: start;
    min-height: 60vh;
    display: block;
    position: relative;
  }

  /* Image styling */
  .image-slider-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    min-height: 200px;
    background-color: #f0f0f0;
  }

  /* Placeholder styling */
  .placeholder-svg {
    width: 100%;
    height: 100%;
    background-color: #f3f3f3;
    border: 2px dashed #ccc;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999;
    font-size: 16px;
    font-weight: 500;
  }

  /* Layout 1: One large + two medium */
  .image-slider-layout-1 {
    display: grid;
    grid-template-columns: 2fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap: 1rem;
    height: 60vh;
    width: 100%;
    padding: 1rem;
    box-sizing: border-box;
  }

  .image-slider-layout-1 .image-slider-large {
    grid-row: 1 / 3;
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    height: 100%;
    min-height: 300px;
    background-color: #e0e0e0;
    border: 2px solid #ccc;
  }

  .image-slider-layout-1 .image-slider-medium-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    height: 100%;
  }

  .image-slider-layout-1 .image-slider-medium {
    flex: 1;
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    height: 100%;
    min-height: 140px;
    background-color: #e0e0e0;
    border: 2px solid #ccc;
  }

  /* Layout 2: One large + four small */
  .image-slider-layout-2 {
    display: grid;
    grid-template-columns: 2fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap: 1rem;
    height: 60vh;
    width: 100%;
    padding: 1rem;
    box-sizing: border-box;
  }

  .image-slider-layout-2 .image-slider-large {
    grid-row: 1 / 3;
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    height: 100%;
    min-height: 300px;
    background-color: #e0e0e0;
    border: 2px solid #ccc;
  }

  .image-slider-layout-2 .image-slider-small-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap: 0.5rem;
    height: 100%;
  }

  .image-slider-layout-2 .image-slider-small {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    height: 100%;
    min-height: 70px;
    background-color: #e0e0e0;
    border: 2px solid #ccc;
  }

  /* Layout 3: Two large */
  .image-slider-layout-3 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    height: 60vh;
    width: 100%;
    padding: 1rem;
    box-sizing: border-box;
  }

  .image-slider-layout-3 .image-slider-large {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    height: 100%;
    min-height: 300px;
    background-color: #e0e0e0;
    border: 2px solid #ccc;
  }

  /* Mobile responsive */
  @media screen and (max-width: 749px) {
    .image-slider-slide {
      min-height: 50vh;
    }

    .image-slider-layout-1,
    .image-slider-layout-2,
    .image-slider-layout-3 {
      grid-template-columns: 1fr;
      grid-template-rows: auto;
      gap: 0.5rem;
      height: auto;
      min-height: 50vh;
      padding: 0.5rem;
    }

    .image-slider-layout-1 .image-slider-large,
    .image-slider-layout-2 .image-slider-large {
      grid-row: auto;
      min-height: 200px;
    }

    .image-slider-layout-1 .image-slider-medium-container {
      flex-direction: row;
    }

    .image-slider-layout-1 .image-slider-medium,
    .image-slider-layout-2 .image-slider-small {
      min-height: 100px;
    }

    .image-slider-layout-3 .image-slider-large {
      min-height: 150px;
    }
  }

  /* Slider navigation */
  .slider-gradient-left,
  .slider-gradient-right {
    z-index: 10;
  }

  .slider-button {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    width: 50px;
    height: 50px;
  }

  .slider-button:hover {
    background: rgba(255, 255, 255, 1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: scale(1.05);
  }

  /* Hide navigation when only one slide */
  .image-slider-grid:has(.slider__slide:only-child) + .slider-gradient-left,
  .image-slider-grid:has(.slider__slide:only-child) + .slider-gradient-right {
    display: none !important;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Ensure slider component initializes properly
    const sliderComponent = document.querySelector('#shopify-section-{{ section.id }} slider-component');
    if (sliderComponent) {
      // Force re-initialization if needed
      setTimeout(() => {
        if (sliderComponent.initPages) {
          sliderComponent.initPages();
        }
      }, 100);
    }

    // Debug: Check if images are loading
    const images = document.querySelectorAll('#shopify-section-{{ section.id }} .image-slider-img');
    console.log('Found', images.length, 'images in slider');
    images.forEach((img, index) => {
      console.log(`Image ${index + 1}:`, img.src, img.complete ? 'loaded' : 'loading');
      img.addEventListener('load', () => {
        console.log(`Image ${index + 1} loaded successfully`);
      });
      img.addEventListener('error', () => {
        console.log(`Image ${index + 1} failed to load:`, img.src);
      });
    });
  });
</script>

{% schema %}
{
  "name": "Image Slider",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Make section full width",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "hide_mobile_slider",
      "label": "Hide slider on mobile",
      "default": false
    },
    {
      "type": "select",
      "id": "color_scheme",
      "options": [
        {
          "value": "accent-1",
          "label": "Accent 1"
        },
        {
          "value": "accent-2",
          "label": "Accent 2"
        },
        {
          "value": "background-1",
          "label": "Background 1"
        },
        {
          "value": "background-2",
          "label": "Background 2"
        },
        {
          "value": "inverse",
          "label": "Inverse"
        }
      ],
      "default": "background-1",
      "label": "Color scheme"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "select",
          "id": "layout",
          "label": "Layout",
          "options": [
            {
              "value": "1",
              "label": "Layout 1 - One large + Two medium"
            },
            {
              "value": "2",
              "label": "Layout 2 - One large + Four small"
            },
            {
              "value": "3",
              "label": "Layout 3 - Two large"
            }
          ],
          "default": "1"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "Image 1 (Large)"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Image 2"
        },
        {
          "type": "image_picker",
          "id": "image_3",
          "label": "Image 3"
        },
        {
          "type": "image_picker",
          "id": "image_4",
          "label": "Image 4 (Layout 2 only)"
        },
        {
          "type": "image_picker",
          "id": "image_5",
          "label": "Image 5 (Layout 2 only)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image Slider",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "layout": "1"
          }
        },
        {
          "type": "slide",
          "settings": {
            "layout": "2"
          }
        },
        {
          "type": "slide",
          "settings": {
            "layout": "3"
          }
        }
      ]
    }
  ]
}
{% endschema %}
